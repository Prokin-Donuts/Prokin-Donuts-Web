<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://www.springframework.org/schema/security
               http://www.springframework.org/schema/security/spring-security.xsd
               http://www.springframework.org/schema/beans
               http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">

<!--LoginSuccessHandler bean 등록-->
    <beans:bean id="LoginSuccessHandler"
                class="com.donut.prokindonutsweb.security.config.LoginSuccessHandler" />
    <!--비밀번호 암호화 해제 bean 등록-->
    <beans:bean id="passwordEncoder"
                class="org.springframework.security.crypto.password.NoOpPasswordEncoder"
                factory-method="getInstance"/>

<!--security 필터를 거치지 않을 경로 설정(로그인 없이 접근 가능한 경로)-->
    <http pattern="/home/signup" security="none" />
    <http pattern="/home/findId" security="none" />
    <http pattern="/home/findPassword" security="none" />
    <http pattern="/home/idCheck" security="none" />
    <http pattern="/home/emailCheck" security="none" />
    <http pattern="/home/resultId" security="none" />
    <http pattern="/home/resultPassword" security="none" />
    <http pattern="/resources/**" security="none" />
    <!-- remove separate <http pattern="/home/login" security="none"/> -->

    <http auto-config="true" use-expressions="true">
        <!--csrf 비활성화-->
        <csrf disabled="true"/>
        <!-- 1) 로그인 폼(GET)과 처리(POST) URL 모두 익명 허용 -->
        <intercept-url pattern="/home/login"        access="permitAll"/>
        <intercept-url pattern="/home/login?error" access="permitAll"/>

        <!-- 2) 정적 리소스도 익명 허용 -->
        <intercept-url pattern="/resources/**" access="permitAll"/>

        <!-- 3) 그 외 모든 요청은 인증 필요 -->
        <intercept-url pattern="/**" access="isAuthenticated()"/>

        <!-- form-login 설정 -->
        <form-login
                login-page="/home/login"
                login-processing-url="/home/login"
                authentication-failure-url="/home/login?error"
                username-parameter="id"
                password-parameter="password"
                authentication-success-handler-ref="LoginSuccessHandler"/>

        <logout
                logout-url="/home/logout"
                logout-success-url="/home/login"
                invalidate-session="true"/>
    </http>

    <!-- AuthenticationManager 및 Provider 설정
        - userDetailsServiceImpl: UserDetailsService 구현체
        - Spring Security는 이를 내부적으로 DaoAuthenticationProvider로 감싸 자동 처리 -->
        <!-- 비밀번호 암호화하지않고 사용(noop 인코더지정 )-->
    <authentication-manager>
        <authentication-provider user-service-ref="userDetailsServiceImpl">
            <password-encoder ref="passwordEncoder"/>
        </authentication-provider>
    </authentication-manager>

</beans:beans>